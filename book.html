<!DOCTYPE html>
<html lang="bn" class="dark">
<head>
  <meta name="description" content="অনলাইনে ফ্রি বাংলা বই পড়ুন এবং ডাউনলোড করুন।">
  <script>
  (function() {
    var ua = navigator.userAgent || navigator.vendor || window.opera;
    var isFacebook = (ua.indexOf("FBAN") > -1) || (ua.indexOf("FBAV") > -1) || (ua.indexOf("Messenger") > -1);

    if (isFacebook) {
      var currentUrl = window.location.href;

      if (ua.indexOf("Android") > -1) {
        var chromeIntent = "intent://" + currentUrl.replace(/^https?:\/\//, "") + "#Intent;scheme=https;package=com.android.chrome;end";
        window.location.href = chromeIntent;
      } 
      else {
        window.addEventListener("load", function() {
          var notice = document.createElement("div");
          // স্টাইলটা একটু মডার্ন করে দিলাম
          notice.style = "position:fixed; top:0; left:0; width:100%; background:#2f3542; color:#ffffff; padding:12px; text-align:center; z-index:99999; font-family:sans-serif; font-size:14px; border-bottom:2px solid #3742fa;";
          
          // আপনার পছন্দের মেসেজ
          notice.innerHTML = "Use <strong>Chrome/Safari</strong> for a better experience and easy downloads.";
          
          document.body.appendChild(notice);
          document.body.style.marginTop = "50px";
        });
      }
    }
  })();
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BoiCloud | বই বিস্তারিত</title>

  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M17.5 19C20.5376 19 23 16.5376 23 13.5C23 10.4624 20.5376 8 17.5 8C17.2282 8 16.9632 8.01977 16.7042 8.05791C15.6841 5.64243 13.284 4 10.5 4C6.91015 4 4 6.91015 4 10.5C4 10.742 4.0133 10.9809 4.03914 11.2158C2.26425 12.0232 1 13.8152 1 15.9C1 18.7167 3.28335 21 6.1 21H17.5V19Z' fill='%2310b981'/%3E%3Cpath d='M8 13.5C8 12.9477 8.44772 12.5 9 12.5H12V16.5H9C8.44772 16.5 8 16.0523 8 15.5V13.5Z' fill='%23059669'/%3E%3Cpath d='M16 13.5C16 12.9477 15.5523 12.5 15 12.5H12V16.5H15C15.5523 16.5 16 16.0523 16 15.5V13.5Z' fill='%232dd4bf'/%3E%3C/svg%3E">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- =========================
    ✅ OG / Social preview (default)
    NOTE: JS will update these per-book after load
  ========================= -->
  <meta property="og:site_name" content="BoiCloud" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="BoiCloud | বই বিস্তারিত" />
  <meta property="og:description" content="BoiCloud এ আপনার পছন্দের বই পড়ুন বা ডাউনলোড করুন।" />
  <meta property="og:image" content="https://images.unsplash.com/photo-1507842217343-583bb7270b66?auto=format&fit=crop&q=80&w=1200" />
  <meta property="og:url" content="" />
  <meta property="og:locale" content="bn_BD" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="BoiCloud | বই বিস্তারিত" />
  <meta name="twitter:description" content="BoiCloud এ আপনার পছন্দের বই পড়ুন বা ডাউনলোড করুন।" />
  <meta name="twitter:image" content="https://images.unsplash.com/photo-1507842217343-583bb7270b66?auto=format&fit=crop&q=80&w=1200" />

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          screens: { xs: '480px' },
          fontFamily: { bengali: ['"Hind Siliguri"', 'sans-serif'] },
          colors: { brand: { 500:'#10b981', 600:'#059669', 700:'#047857' } }
        }
      }
    }
  </script>

  <style>
    body { font-family:'Hind Siliguri',sans-serif; -webkit-tap-highlight-color: transparent; }
    .glass-effect { backdrop-filter: blur(12px); background: rgba(255,255,255,.82); }
    .dark .glass-effect { background: rgba(15,23,42,.82); }
    .no-scrollbar::-webkit-scrollbar { display:none; }
    .no-scrollbar { -ms-overflow-style:none; scrollbar-width:none; }
    /* ✅ Skeleton Loading Effect */
    .skeleton {
        background: #e2e8f0; 
        background-image: linear-gradient(90deg, rgba(226,232,240,0) 0, rgba(241,245,249,.5) 50%, rgba(226,232,240,0) 100%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        position: relative;
        overflow: hidden;
    }

    .dark .skeleton {
        background: #1e293b;
        background-image: linear-gradient(90deg, rgba(30,41,59,0) 0, rgba(51,65,85,.5) 50%, rgba(30,41,59,0) 100%);
    }

    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    /* ✅ swipe snap */
    .snap-x { scroll-snap-type: x mandatory; }
    .snap-start { scroll-snap-align: start; }

    /* toast safe bottom */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(22px + env(safe-area-inset-bottom));
      z-index: 999;
      max-width: 92vw;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 transition-colors duration-300 antialiased overflow-x-hidden">

  <!-- ✅ Data -->
  <script src="books-data.js"></script>

  <!-- ================= HEADER ================= -->
  <header class="sticky top-0 z-50 glass-effect border-b border-slate-200 dark:border-slate-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16 sm:h-20">
        <a href="index.html" class="flex items-center gap-3 min-w-0">
          <svg class="w-10 h-10 sm:w-12 sm:h-12 shrink-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.5 19C20.5376 19 23 16.5376 23 13.5C23 10.4624 20.5376 8 17.5 8C17.2282 8 16.9632 8.01977 16.7042 8.05791C15.6841 5.64243 13.284 4 10.5 4C6.91015 4 4 6.91015 4 10.5C4 10.742 4.0133 10.9809 4.03914 11.2158C2.26425 12.0232 1 13.8152 1 15.9C1 18.7167 3.28335 21 6.1 21H17.5V19Z"
                  class="fill-brand-500/10 stroke-brand-500 dark:fill-brand-700/20 dark:stroke-brand-500" stroke-width="1.5"/>
            <path d="M8 13.5C8 12.9477 8.44772 12.5 9 12.5H12V16.5H9C8.44772 16.5 8 16.0523 8 15.5V13.5Z" class="fill-brand-600"/>
            <path d="M16 13.5C16 12.9477 15.5523 12.5 15 12.5H12V16.5H15C15.5523 16.5 16 16.0523 16 15.5V13.5Z" class="fill-teal-400"/>
          </svg>

          <h1 class="text-xl sm:text-3xl font-black tracking-tighter whitespace-nowrap truncate">
            <span class="text-slate-800 dark:text-white">Boi</span><span class="bg-gradient-to-r from-brand-600 to-teal-500 bg-clip-text text-transparent">Cloud</span>
          </h1>
        </a>

        <div class="flex items-center gap-2 shrink-0">
          <a href="index.html" class="p-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/60 hover:border-brand-500/40 transition-colors" title="Home">
            <i data-lucide="home" class="w-5 h-5"></i>
          </a>
          <a href="index.html#category-buttons" class="p-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/60 hover:border-brand-500/40 transition-colors" title="Category">
            <i data-lucide="grid" class="w-5 h-5"></i>
          </a>
          <button id="dark-mode-toggle" class="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-600 dark:text-slate-400" title="Theme"></button>
        </div>
      </div>
    </div>
  </header>

  <!-- ================= MAIN ================= -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-10">
    <div class="container mx-auto p-4">

  <div id="loading-skeleton" class="space-y-4">
    <div class="skeleton h-64 w-44 rounded-xl mx-auto"></div> <div class="skeleton h-6 w-3/4 rounded mx-auto"></div>    <div class="skeleton h-4 w-1/2 rounded mx-auto"></div>    </div>

  <div id="main-content" class="hidden">
    <img id="display-cover" src="" class="mx-auto rounded-xl shadow-lg" />
    <h1 id="display-title" class="text-2xl font-bold text-center mt-4"></h1>
    <p id="display-author" class="text-center text-slate-500"></p>
    </div>

</div>
    <div id="not-found" class="hidden text-center py-16">
      <div class="w-20 h-20 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
        <i data-lucide="alert-triangle" class="w-10 h-10 text-slate-400"></i>
      </div>
      <h2 class="text-2xl font-black mb-2">বই পাওয়া যায়নি</h2>
      <p class="text-slate-500 dark:text-slate-400 mb-6">লিংকটি ভুল হতে পারে।</p>
      <a href="index.html" class="inline-flex items-center gap-2 px-6 py-3 bg-brand-600 hover:bg-brand-700 text-white rounded-2xl font-black">
        <i data-lucide="arrow-left" class="w-5 h-5"></i> হোমে ফিরে যান
      </a>
    </div>

    <section id="book-section" class="space-y-6">

      <!-- ✅ Cover Card -->
      <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-3xl overflow-hidden shadow-lg">
        <div class="px-4 pt-4 pb-3 flex items-center justify-between gap-3">
          <span id="book-category"
                class="px-3 py-1 rounded-full text-[11px] font-black bg-brand-500/10 text-brand-600 border border-brand-500/20 whitespace-nowrap">—</span>
          <span class="text-[10px] uppercase tracking-[3px] text-slate-400">details</span>
        </div>

        <div class="px-4 pb-4">
          <div class="mx-auto max-w-[340px] sm:max-w-[380px]">
            <div class="aspect-[2/3] rounded-2xl overflow-hidden border border-slate-200 dark:border-slate-800">
              <img id="book-cover" src="" alt="" class="w-full h-full object-cover">
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ Details + Actions -->
      <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-3xl p-5 sm:p-7 shadow-lg">
        <h2 id="book-title" class="text-2xl sm:text-4xl font-black leading-tight break-words">—</h2>

        <p class="mt-2 text-slate-500 dark:text-slate-400 font-bold break-words">
          <i data-lucide="user" class="w-4 h-4 inline mr-1"></i>
          <span id="book-author">—</span>
        </p>

        <div class="mt-6">
          <h3 class="text-sm font-black flex items-center gap-2">
            <i data-lucide="info" class="w-4 h-4"></i> বিস্তারিত
          </h3>
          <p id="book-desc" class="mt-2 text-slate-600 dark:text-slate-300 leading-relaxed break-words">—</p>
        </div>

        <!-- ✅ Buttons: Home + পড়ুন + ডাউনলোড -->
        <div class="mt-6 grid grid-cols-1 xs:grid-cols-3 gap-3">
          <a id="read-btn" href="#"
             class="w-full px-5 py-3 rounded-2xl font-black text-sm bg-brand-600 hover:bg-brand-700 text-white inline-flex items-center justify-center gap-2">
            <i data-lucide="book-open" class="w-5 h-5"></i> পড়ুন
          </a>

          <a id="download-btn" 
   href="https://drive.google.com/uc?export=download&id=আপনার_ফাইল_আইডি"
   target="_blank" 
   rel="noopener noreferrer"
   class="w-full px-5 py-3 rounded-2xl font-black text-sm bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-800 dark:text-slate-200 inline-flex items-center justify-center gap-2">
   <i data-lucide="download" class="w-5 h-5"></i> ডাউনলোড
</a>

          <a href="index.html"
             class="w-full px-5 py-3 rounded-2xl font-black text-sm bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:border-brand-500/40 inline-flex items-center justify-center gap-2">
            <i data-lucide="arrow-left" class="w-5 h-5"></i> Home
          </a>
        </div>

        <!-- ✅ Category jump (as you wanted) -->
        <div class="mt-3">
          <a href="index.html#category-buttons"
             class="w-full xs:w-auto px-5 py-3 rounded-2xl font-black text-sm bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 hover:border-brand-500/40 inline-flex items-center justify-center gap-2">
            <i data-lucide="grid" class="w-5 h-5"></i> Category তে যান
          </a>
        </div>
      </div>

      <!-- ✅ Share + Copy on header row -->
      <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-3xl p-5 shadow-sm">
        <div class="flex items-center justify-between gap-3">
          <h3 class="text-sm font-black flex items-center gap-2">
            <i data-lucide="share-2" class="w-4 h-4"></i> Share
          </h3>

          <!-- ✅ Copy beside share -->
          <button id="copy-link"
            class="px-3 py-2 rounded-xl text-xs font-black bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors inline-flex items-center gap-2 whitespace-nowrap">
            <i data-lucide="copy" class="w-4 h-4"></i> Copy link
          </button>
        </div>

        <!-- ✅ ORDER: fb, ms, wa, tg, x -->
        <div class="mt-4 grid grid-cols-2 sm:grid-cols-5 gap-2">
          <a id="share-fb" target="_blank"
             class="px-3 py-2 rounded-xl text-xs font-black bg-slate-100 dark:bg-slate-800 hover:bg-blue-600 hover:text-white transition-colors inline-flex items-center justify-center gap-2">
            <i class="fab fa-facebook-f"></i> Facebook
          </a>

          <a id="share-ms" target="_blank"
             class="px-3 py-2 rounded-xl text-xs font-black bg-slate-100 dark:bg-slate-800 hover:bg-indigo-600 hover:text-white transition-colors inline-flex items-center justify-center gap-2">
            <i class="fab fa-facebook-messenger"></i> Messenger
          </a>

          <a id="share-wa" target="_blank"
             class="px-3 py-2 rounded-xl text-xs font-black bg-slate-100 dark:bg-slate-800 hover:bg-green-600 hover:text-white transition-colors inline-flex items-center justify-center gap-2">
            <i class="fab fa-whatsapp"></i> WhatsApp
          </a>

          <a id="share-tg" target="_blank"
             class="px-3 py-2 rounded-xl text-xs font-black bg-slate-100 dark:bg-slate-800 hover:bg-sky-500 hover:text-white transition-colors inline-flex items-center justify-center gap-2">
            <i class="fab fa-telegram-plane"></i> Telegram
          </a>

          <a id="share-x" target="_blank"
             class="px-3 py-2 rounded-xl text-xs font-black bg-slate-100 dark:bg-slate-800 hover:bg-black hover:text-white transition-colors inline-flex items-center justify-center gap-2">
            <i class="fab fa-x-twitter"></i> X
          </a>
        </div>
      </div>

      <!-- ✅ Related carousel -->
      <div>
        <div class="flex items-end justify-between gap-4 mb-3">
          <div>
            <h3 class="text-lg sm:text-xl font-black flex items-center gap-2">
              <i data-lucide="sparkles" class="w-5 h-5 text-brand-600"></i> Related Books
            </h3>
            <p class="text-xs text-slate-500 dark:text-slate-400">ডানে-বামে swipe করে আরও বই দেখুন</p>
          </div>
          <span class="text-[10px] uppercase tracking-[3px] text-slate-400">Related items</span>
        </div>

        <div id="related-wrap" class="flex gap-3 overflow-x-auto no-scrollbar snap-x pb-2"></div>
      </div>

    </section>
  </main>

  <!-- ================= FOOTER (inline links) ================= -->
  <footer class="bg-white dark:bg-slate-900 border-t dark:border-slate-800 pt-8 pb-0">
    <div class="max-w-7xl mx-auto px-6 pb-8">
      <div class="flex flex-wrap gap-x-6 gap-y-3 justify-center md:justify-start text-sm text-slate-500 dark:text-slate-400">
        <span id="link-home" class="hover:text-brand-600 cursor-pointer transition-colors inline-flex items-center gap-2"><i data-lucide="home" class="w-4 h-4"></i> হোম</span>
        <span id="link-books" class="hover:text-brand-600 cursor-pointer transition-colors inline-flex items-center gap-2"><i data-lucide="book-open" class="w-4 h-4"></i> বইয়ের তালিকা</span>
        <span id="link-category" class="hover:text-brand-600 cursor-pointer transition-colors inline-flex items-center gap-2"><i data-lucide="grid" class="w-4 h-4"></i> ক্যাটাগরি</span>
<a href="mailto:html.arif@gmail.com?subject=যোগাযোগ - BoiCloud&body=আপনার বার্তা:%0A" 
   class="hover:text-brand-600 cursor-pointer transition-colors inline-flex items-center gap-2">
  <i data-lucide="mail" class="w-4 h-4"></i> যোগাযোগ
</a>
        <a href="https://forms.gle/4XdfJcvaYMfxPrmf8" target="_blank" class="hover:text-brand-600 cursor-pointer transition-colors inline-flex items-center gap-2">
    <i data-lucide="message-square-plus" class="w-4 h-4"></i> বইয়ের অনুরোধ
  </a>
        <a href="https://forms.gle/XvUkcvWMTHBAHjEp6" target="_blank" class="hover:text-teal-500 transition-colors inline-flex items-center gap-2">
    <i data-lucide="upload-cloud" class="w-4 h-4 text-teal-500"></i> বই পাঠান
  </a>
      </div>
    </div>

    <div class="border-t border-slate-200 dark:border-slate-800">
      <div class="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="text-sm text-slate-500 dark:text-slate-400 font-medium text-center md:text-left">
          &copy; <span id="current-year"></span>
          <span class="ml-2 px-3 py-1 rounded-xl border border-brand-500/20 bg-slate-900/90 dark:bg-slate-900/60 shadow-sm inline-block">
            <span class="font-black tracking-tight whitespace-nowrap">
              <span class="text-white">Boi</span><span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-600 via-teal-400 to-brand-600">Cloud</span>
            </span>
          </span>
          <span class="ml-2">All rights reserved.</span>
        </div>

        <div class="flex items-center gap-2">
          <span class="text-[10px] uppercase tracking-[3px] text-slate-400 dark:text-slate-500 font-bold whitespace-nowrap">Powered by</span>
          <div class="flex items-center gap-1 px-3 py-1.5 rounded-lg bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-sm">
            <i data-lucide="sparkles" class="w-4 h-4 text-brand-600"></i>
            <span class="text-sm font-black tracking-tight whitespace-nowrap">
              <span class="text-slate-800 dark:text-slate-200">Arif</span><span class="bg-gradient-to-r from-brand-600 to-teal-500 bg-clip-text text-transparent">icial</span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script>
    lucide.createIcons();

    // ========================= TOAST =========================
    const escapeHtml = (s) => String(s ?? '')
      .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
      .replaceAll('"','&quot;').replaceAll("'",'&#039;');

    function showToast(message, type='info') {
      const old = document.getElementById('toast');
      if (old) old.remove();

      const toast = document.createElement('div');
      toast.id = 'toast';
      toast.className = 'toast';
      toast.innerHTML = `
        <div class="px-4 py-3 rounded-2xl shadow-xl border backdrop-blur-md
          ${type==='error'
            ? 'bg-red-500/10 border-red-500/30 text-slate-900 dark:text-red-100'
            : 'bg-brand-500/10 border-brand-500/30 text-slate-900 dark:text-slate-100'}">
          <div class="flex items-start gap-3">
            <div class="mt-0.5">
              ${type==='error'
                ? '<i data-lucide="alert-triangle" class="w-5 h-5 text-red-400"></i>'
                : '<i data-lucide="sparkles" class="w-5 h-5 text-brand-500"></i>'}
            </div>
            <div class="text-sm leading-relaxed">${escapeHtml(message)}</div>
            <button class="ml-2 opacity-70 hover:opacity-100" aria-label="Close">
              <i data-lucide="x" class="w-4 h-4"></i>
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(toast);
      lucide.createIcons();
      toast.querySelector('button')?.addEventListener('click', () => toast.remove());
      setTimeout(() => toast.remove(), 2200);
    }

    // ========================= THEME =========================
    function initializeDarkMode() {
      const savedTheme = localStorage.getItem('boicloud-theme');
      if (savedTheme === null) {
        document.documentElement.classList.add('dark');
        localStorage.setItem('boicloud-theme', 'dark');
        return true;
      }
      const isDark = savedTheme === 'dark';
      document.documentElement.classList.toggle('dark', isDark);
      return isDark;
    }
    function updateDarkModeToggle(isDark) {
      const btn = document.getElementById('dark-mode-toggle');
      if (!btn) return;
      btn.innerHTML = isDark
        ? '<i data-lucide="sun" class="w-5 h-5 text-yellow-300"></i>'
        : '<i data-lucide="moon" class="w-5 h-5 text-slate-700"></i>';
      lucide.createIcons();
    }
    function toggleDarkMode() {
      const html = document.documentElement;
      const isDark = html.classList.contains('dark');
      html.classList.toggle('dark', !isDark);
      localStorage.setItem('boicloud-theme', !isDark ? 'dark' : 'light');
      updateDarkModeToggle(!isDark);
    }

    // ========================= HELPERS =========================
    function normalizeBooks(list) {
      return (list || []).map(b => {
        const book = { ...b };
        if (!book.categories || !Array.isArray(book.categories) || book.categories.length === 0) {
          if (book.category && typeof book.category === 'string') book.categories = [book.category];
          else book.categories = ['অন্যান্য'];
        }
        book.category = book.categories[0] || 'অন্যান্য';
        return book;
      });
    }

    function getIdFromQuery() {
      const params = new URLSearchParams(location.search);
      return params.get('id');
    }

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // ✅ Related: same category 3 + mix all categories + fill up to 50
    function buildRelatedBooks(currentBook, allBooks, total = 50) {
      const currentId = currentBook.id;
      const currentCat = currentBook.category;
      const others = allBooks.filter(b => b.id !== currentId);

      const used = new Set([currentId]);
      const result = [];

      const pushUnique = (b) => {
        if (!b || used.has(b.id)) return;
        used.add(b.id);
        result.push(b);
      };

      // 1) same category 3
      shuffle(others.filter(b => b.category === currentCat)).slice(0, 3).forEach(pushUnique);

      // 2) every category bring 1~2
      const cats = shuffle([...new Set(others.map(b => b.category))]);
      cats.forEach(cat => {
        const pool = shuffle(others.filter(b => b.category === cat));
        if (pool[0]) pushUnique(pool[0]);
        if (pool[1] && result.length < total && Math.random() > 0.5) pushUnique(pool[1]);
      });

      // 3) fill remaining
      shuffle(others).forEach(pushUnique);

      return result.slice(0, total);
    }

    function isValidLink(url) {
      if (!url) return false;
      const u = String(url).trim();
      return !(u === '#' || u === '');
    }

    // ✅ Update meta tags for social preview (best-effort)
    function setMeta(attr, key, value) {
      if (!value) return;
      const selector = attr === 'property'
        ? `meta[property="${key}"]`
        : `meta[name="${key}"]`;
      let tag = document.querySelector(selector);
      if (!tag) {
        tag = document.createElement('meta');
        tag.setAttribute(attr, key);
        document.head.appendChild(tag);
      }
      tag.setAttribute('content', value);
    }

   function updateSocialMeta(book) {
      // ১. টাইটেলে আগে বইয়ের নাম ও লেখকের নাম দিন (SEO এর জন্য সেরা)
      const title = `${book.title} - ${book.author} | BoiCloud`;
      
      const desc = (book.description && String(book.description).trim())
        ? String(book.description).trim().slice(0, 180)
        : `${book.title} — ${book.author} | BoiCloud এ অনলাইনে পড়ুন বা ফ্রি ডাউনলোড করুন।`;

      const url = location.href;
      const img = book.coverImage || '';

      // ২. ব্রাউজার ট্যাবের নাম পরিবর্তন
      document.title = title;

      // ৩. গুগলের জন্য মেটা ডেসক্রিপশন সেট করা
      setMeta('name', 'description', desc);

      // ৪. বাকি মেটা ট্যাগগুলো
      setMeta('property', 'og:title', title);
      setMeta('property', 'og:description', desc);
      setMeta('property', 'og:url', url);
      if (img) setMeta('property', 'og:image', img);

      setMeta('name', 'twitter:title', title);
      setMeta('name', 'twitter:description', desc);
      if (img) setMeta('name', 'twitter:image', img);
    }
     
    

    function renderBookDetails(book) {
      // Title/meta
      updateSocialMeta(book);

      document.getElementById('book-title').textContent = book.title;
      document.getElementById('book-author').textContent = book.author;
      document.getElementById('book-category').textContent = book.category;
      document.getElementById('book-desc').textContent =
        book.description || 'এই বইটির জন্য এখনো বিস্তারিত বর্ণনা যোগ করা হয়নি।';
      const coverImgElement = document.getElementById('book-cover');
      coverImgElement.src = book.coverImage;
      coverImgElement.alt = book.altText || `${book.title} - ${book.author}`;

      // Buttons
      const readBtn = document.getElementById('read-btn');
      const downBtn = document.getElementById('download-btn');

      const readOk = isValidLink(book.readLink);
      const downOk = isValidLink(book.downloadLink);

      readBtn.href = readOk ? book.readLink : 'javascript:void(0)';
      downBtn.href = downOk ? book.downloadLink : 'javascript:void(0)';

      if (!readOk) readBtn.classList.add('opacity-60', 'cursor-not-allowed');
      if (!downOk) downBtn.classList.add('opacity-60', 'cursor-not-allowed');

      readBtn.addEventListener('click', (e) => {
        if (!readOk) { e.preventDefault(); showToast('দুঃখিত! এই বইয়ের পড়ার লিংক এখনো আপডেট করা হয়নি।', 'error'); }
      });
      downBtn.addEventListener('click', (e) => {
        if (!downOk) { e.preventDefault(); showToast('দুঃখিত! এই বইয়ের ডাউনলোড লিংক এখনো আপডেট করা হয়নি।', 'error'); }
      });

      // Share links
      const shareUrlRaw = location.href;
      const shareUrl = encodeURIComponent(shareUrlRaw);
      const shareText = encodeURIComponent(`${book.title} - ${book.author}`);

      // Facebook share (post dialog)
      document.getElementById('share-fb').href =
        `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;

      // Messenger:
      // ✅ If you have an FB App ID, put it here.
      // Without App ID, fallback will open FB share (still usable).
      const FB_APP_ID = ''; // <-- e.g. '123456789012345'
      const msBtn = document.getElementById('share-ms');
      if (FB_APP_ID) {
        msBtn.href = `https://www.facebook.com/dialog/send?link=${shareUrl}&redirect_uri=${shareUrl}&app_id=${encodeURIComponent(FB_APP_ID)}`;
      } else {
        msBtn.href = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
      }

      // WhatsApp
      document.getElementById('share-wa').href =
        `https://wa.me/?text=${shareText}%20${shareUrl}`;

      // Telegram
      document.getElementById('share-tg').href =
        `https://t.me/share/url?url=${shareUrl}&text=${shareText}`;

      // X
      document.getElementById('share-x').href =
        `https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}`;
    }

    function renderRelatedCarousel(list) {
      const wrap = document.getElementById('related-wrap');
      wrap.innerHTML = list.map(b => `
        <a href="book.html?id=${encodeURIComponent(b.id)}"
           class="snap-start shrink-0 w-28 xs:w-32 sm:w-36 md:w-40 group">
          <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl overflow-hidden shadow-sm hover:-translate-y-1 transition-transform">
            <div class="aspect-[2/3] overflow-hidden">
              <img src="${b.coverImage}" loading="lazy"
                   class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" alt="">
            </div>
            <div class="p-2.5">
              <div class="text-[10px] font-black text-brand-600 line-clamp-1">${b.category}</div>
              <div class="text-[12px] sm:text-sm font-black text-slate-900 dark:text-white line-clamp-1 group-hover:text-brand-600 transition-colors">${b.title}</div>
              <div class="text-[10px] sm:text-xs text-slate-500 dark:text-slate-400 line-clamp-1">${b.author}</div>
            </div>
          </div>
        </a>
      `).join('');
      lucide.createIcons();
    }

    // ✅ One click copy (no extra)
    async function copyLinkInstant() {
      const url = location.href;
      try {
        await navigator.clipboard.writeText(url);
        showToast('লিংক কপি হয়েছে ✅');
      } catch {
        // fallback if clipboard blocked
        const temp = document.createElement('input');
        temp.value = url;
        document.body.appendChild(temp);
        temp.select();
        document.execCommand('copy');
        temp.remove();
        showToast('লিংক কপি হয়েছে ✅');
      }
    }

    function bindFooterLinks() {
      document.getElementById('link-home')?.addEventListener('click', () => location.href='index.html');
      document.getElementById('link-books')?.addEventListener('click', () => location.href='index.html#books-grid');
      document.getElementById('link-category')?.addEventListener('click', () => location.href='index.html#category-buttons');
      document.getElementById('link-contact')?.addEventListener('click', () => location.href="https://mail.google.com/mail/?view=cm&fs=1&to=html.arif@gmail.com");
    }

    function init() {
      const isDark = initializeDarkMode();
      updateDarkModeToggle(isDark);
      document.getElementById('dark-mode-toggle')?.addEventListener('click', toggleDarkMode);

      document.getElementById('current-year').textContent = new Date().getFullYear();
      bindFooterLinks();

      document.getElementById('copy-link')?.addEventListener('click', copyLinkInstant);

      const allBooks = normalizeBooks(window.BOOKS_DATA || []);
      const id = getIdFromQuery();
      const book = allBooks.find(b => String(b.id) === String(id));

      if (!book) {
        document.getElementById('not-found')?.classList.remove('hidden');
        document.getElementById('book-section')?.classList.add('hidden');
        return;
      }

      renderBookDetails(book);
      renderRelatedCarousel(buildRelatedBooks(book, allBooks, 50));
      lucide.createIcons();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
